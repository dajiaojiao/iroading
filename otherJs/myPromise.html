<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        function MyPromise(callBack){
            this.successCallBack = null;
            this.failCallBack = null;
            this.status = "pending";
            this.successData = null;
            this.errorData = null;
            this.hasCallSuccess = false;
            this.hasCallfail = false;
            this.nextCall = null;
            callBack((data) => {
                this.hasCallSuccess = true;
                this.successData = data;
                this.resolveFunc(data);
            },(data) =>{
                this.hasCallfail = true;
                this.errorData = data;
                this.rejectFunc(data);
            });
        }    
        MyPromise.prototype.resolveFunc = function(data){
            if(this.successCallBack){
                const result = this.successCallBack(data);
                this.status = "resolved";
                if(result instanceof MyPromise){
                    result.then((data)=>{this.nextCall(data)})
                }else{
                    this.nextCall(result);
                }
            }
        }
        MyPromise.prototype.rejectFunc = function(data){
            if(this.failCallBack){
                this.failCallBack(data);
                this.status = "rejected";
            }
        }
        MyPromise.prototype.then = function(success,fail){
            return new MyPromise((resolve,reject) => {
                let result = void(0);
                this.successCallBack = success;
                this.failCallBack = fail;
                if(this.hasCallSuccess){
                    result = this.successCallBack(this.successData);
                }else if(this.hasCallfail){
                    result = this.failCallBack(this.errorData);
                }

                if(this.hasCallSuccess || this.hasCallfail){
                    if(result instanceof MyPromise){
                        result.then(function(data){resolve(data)});
                    }else{
                        resolve(result);
                    }
                }else{
                    this.nextCall = resolve;
                }
            })
        }

        MyPromise.resolve = function(data){
            return new MyPromise(function(resolve,reject){
                resolve(data);
            });
        };
        MyPromise.reject = function(data){
            return new MyPromise(function(resolve,reject){
                reject(data);
            });
        };

        new MyPromise(function(resolve,reject){
            setTimeout(function(){
                resolve("3333")
            },1000)
        })
        .then(function(data){
            console.log(data,"第一次");
            return new MyPromise(function(resolve,reject){
                resolve("444")
            })
        })
        .then(function(data){
            console.log(data,"第二次");
            return new MyPromise((resolve) => {
                setTimeout(function(){resolve("5555")},3000)
            })
        })
        .then(function(data){
            console.log(data,"第三次")
        })
        
    </script>
</body>
</html>